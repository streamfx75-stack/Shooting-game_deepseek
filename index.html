<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シンプルシューティングゲーム</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom, #0c0c2e, #1a1a3e);
            font-family: 'Arial', sans-serif;
            color: #fff;
            padding: 20px;
        }
        
        .game-container {
            text-align: center;
            max-width: 800px;
            width: 100%;
        }
        
        h1 {
            margin-bottom: 10px;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
            font-size: 2.5rem;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            background-color: rgba(0, 0, 50, 0.5);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #4fc3f7;
        }
        
        .info-item {
            font-size: 1.2rem;
        }
        
        .info-value {
            color: #4fc3f7;
            font-weight: bold;
            font-size: 1.4rem;
        }
        
        #gameCanvas {
            border: 3px solid #4fc3f7;
            border-radius: 5px;
            background-color: #000;
            box-shadow: 0 0 20px rgba(79, 195, 247, 0.3);
            display: block;
            margin: 0 auto;
        }
        
        .controls {
            margin-top: 20px;
            background-color: rgba(0, 0, 50, 0.5);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #4fc3f7;
        }
        
        .controls h2 {
            margin-bottom: 10px;
            color: #4fc3f7;
        }
        
        .key {
            display: inline-block;
            background-color: #333;
            color: #fff;
            padding: 5px 10px;
            margin: 0 5px;
            border-radius: 5px;
            border: 1px solid #4fc3f7;
        }
        
        button {
            background-color: #4fc3f7;
            color: #000;
            border: none;
            padding: 12px 25px;
            margin-top: 15px;
            font-size: 1.1rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background-color: #29b6f6;
            transform: scale(1.05);
        }
        
        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 50, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #4fc3f7;
            text-align: center;
            z-index: 10;
            display: none;
            max-width: 400px;
            width: 90%;
        }
        
        .game-message h2 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 2rem;
        }
        
        .game-message p {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        @media (max-width: 768px) {
            #gameCanvas {
                width: 100%;
                height: auto;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>スペースシューティング</h1>
        
        <div class="game-info">
            <div class="info-item">
                スコア: <span id="score" class="info-value">0</span>
            </div>
            <div class="info-item">
                ライフ: <span id="lives" class="info-value">3</span>
            </div>
            <div class="info-item">
                レベル: <span id="level" class="info-value">1</span>
            </div>
        </div>
        
        <canvas id="gameCanvas" width="800" height="500"></canvas>
        
        <div class="controls">
            <h2>操作方法</h2>
            <p>
                <span class="key">←</span> <span class="key">→</span> キーで移動 /
                <span class="key">スペース</span> キーで発射 /
                <span class="key">P</span> キーでポーズ
            </p>
            <button id="startButton">ゲームスタート</button>
            <button id="pauseButton">ポーズ</button>
        </div>
        
        <div id="gameMessage" class="game-message">
            <h2 id="messageTitle">ゲームスタート</h2>
            <p id="messageText">スタートボタンを押してゲームを開始してください</p>
            <button id="messageButton">スタート</button>
        </div>
    </div>

    <script>
        // ゲーム要素の取得
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const levelElement = document.getElementById('level');
        const startButton = document.getElementById('startButton');
        const pauseButton = document.getElementById('pauseButton');
        const gameMessage = document.getElementById('gameMessage');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const messageButton = document.getElementById('messageButton');

        // ゲーム状態
        let game = {
            running: false,
            paused: false,
            score: 0,
            lives: 3,
            level: 1,
            enemySpeed: 2,
            enemySpawnRate: 100, // フレーム単位
            lastEnemySpawn: 0,
            gameOver: false
        };

        // プレイヤー
        const player = {
            x: canvas.width / 2 - 25,
            y: canvas.height - 60,
            width: 50,
            height: 40,
            speed: 7,
            color: '#4fc3f7',
            isMovingLeft: false,
            isMovingRight: false,
            shootCooldown: 0
        };

        // 弾と敵の配列
        let bullets = [];
        let enemies = [];
        let particles = [];

        // キー入力の処理
        const keys = {};

        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // スペースキーで弾を発射
            if (e.key === ' ' && game.running && !game.paused) {
                shootBullet();
                e.preventDefault(); // スペースキーでページがスクロールするのを防止
            }
            
            // Pキーでポーズ/再開
            if (e.key === 'p' || e.key === 'P') {
                togglePause();
            }
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // プレイヤーの移動制御
        function handlePlayerMovement() {
            if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
                player.x -= player.speed;
                player.isMovingLeft = true;
                player.isMovingRight = false;
            } else if (keys['ArrowRight'] || keys['d'] || keys['D']) {
                player.x += player.speed;
                player.isMovingLeft = false;
                player.isMovingRight = true;
            } else {
                player.isMovingLeft = false;
                player.isMovingRight = false;
            }
            
            // 画面外に行かないようにする
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
            
            // クールダウンを減少
            if (player.shootCooldown > 0) {
                player.shootCooldown--;
            }
        }

        // 弾を発射
        function shootBullet() {
            if (player.shootCooldown === 0) {
                bullets.push({
                    x: player.x + player.width / 2 - 3,
                    y: player.y,
                    width: 6,
                    height: 15,
                    speed: 10,
                    color: '#ffeb3b'
                });
                
                player.shootCooldown = 10; // 発射間隔
            }
        }

        // 敵を生成
        function spawnEnemy() {
            const enemyWidth = 30 + Math.random() * 30;
            const enemyHeight = 30 + Math.random() * 30;
            
            enemies.push({
                x: Math.random() * (canvas.width - enemyWidth),
                y: -enemyHeight,
                width: enemyWidth,
                height: enemyHeight,
                speed: game.enemySpeed + Math.random() * 1.5,
                color: `hsl(${Math.random() * 60 + 300}, 70%, 60%)` // 紫系の色
            });
        }

        // パーティクルを生成（エフェクト用）
        function createParticles(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * 5 + 2,
                    speedX: Math.random() * 6 - 3,
                    speedY: Math.random() * 6 - 3,
                    color: color,
                    life: 30
                });
            }
        }

        // ゲームの更新
        function updateGame() {
            if (!game.running || game.paused || game.gameOver) return;
            
            // プレイヤーの移動
            handlePlayerMovement();
            
            // 敵の生成
            game.lastEnemySpawn++;
            if (game.lastEnemySpawn >= game.enemySpawnRate) {
                spawnEnemy();
                game.lastEnemySpawn = 0;
            }
            
            // 弾の移動
            for (let i = bullets.length - 1; i >= 0; i--) {
                bullets[i].y -= bullets[i].speed;
                
                // 画面外に出た弾を削除
                if (bullets[i].y < -bullets[i].height) {
                    bullets.splice(i, 1);
                }
            }
            
            // 敵の移動と衝突判定
            for (let i = enemies.length - 1; i >= 0; i--) {
                enemies[i].y += enemies[i].speed;
                
                // 敵が画面外に出た場合
                if (enemies[i].y > canvas.height) {
                    enemies.splice(i, 1);
                    continue;
                }
                
                // プレイヤーとの衝突
                if (checkCollision(player, enemies[i])) {
                    enemies.splice(i, 1);
                    game.lives--;
                    livesElement.textContent = game.lives;
                    createParticles(player.x + player.width/2, player.y + player.height/2, '#ff5252', 15);
                    
                    if (game.lives <= 0) {
                        gameOver();
                    }
                    continue;
                }
                
                // 弾との衝突
                for (let j = bullets.length - 1; j >= 0; j--) {
                    if (checkCollision(bullets[j], enemies[i])) {
                        // 敵を削除
                        enemies.splice(i, 1);
                        // 弾を削除
                        bullets.splice(j, 1);
                        // スコア加算
                        game.score += 10 * game.level;
                        scoreElement.textContent = game.score;
                        // パーティクルを生成
                        createParticles(enemies[i].x + enemies[i].width/2, enemies[i].y + enemies[i].height/2, '#4fc3f7', 10);
                        
                        // レベルアップチェック
                        if (game.score >= game.level * 100) {
                            game.level++;
                            levelElement.textContent = game.level;
                            game.enemySpeed += 0.5;
                            game.enemySpawnRate = Math.max(30, game.enemySpawnRate - 10);
                            showMessage(`レベル ${game.level}`, `敵のスピードが上がりました！`);
                        }
                        
                        break;
                    }
                }
            }
            
            // パーティクルの更新
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].x += particles[i].speedX;
                particles[i].y += particles[i].speedY;
                particles[i].life--;
                
                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        // 衝突判定
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // 描画
        function draw() {
            // 背景の描画
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 星の描画（背景効果）
            drawStars();
            
            // プレイヤーの描画
            drawPlayer();
            
            // 弾の描画
            for (const bullet of bullets) {
                ctx.fillStyle = bullet.color;
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                
                // 弾の光る効果
                ctx.shadowBlur = 10;
                ctx.shadowColor = bullet.color;
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                ctx.shadowBlur = 0;
            }
            
            // 敵の描画
            for (const enemy of enemies) {
                ctx.fillStyle = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                
                // 敵の光る効果
                ctx.shadowBlur = 15;
                ctx.shadowColor = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                ctx.shadowBlur = 0;
                
                // 敵の目を描画
                ctx.fillStyle = '#fff';
                const eyeSize = enemy.width / 6;
                ctx.fillRect(enemy.x + enemy.width/3 - eyeSize/2, enemy.y + enemy.height/3 - eyeSize/2, eyeSize, eyeSize);
                ctx.fillRect(enemy.x + 2*enemy.width/3 - eyeSize/2, enemy.y + enemy.height/3 - eyeSize/2, eyeSize, eyeSize);
            }
            
            // パーティクルの描画
            for (const particle of particles) {
                ctx.globalAlpha = particle.life / 30;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            }
            
            // ゲームオーバー時の表示
            if (game.gameOver) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#ff5252';
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 30);
                
                ctx.fillStyle = '#fff';
                ctx.font = '24px Arial';
                ctx.fillText(`最終スコア: ${game.score}`, canvas.width / 2, canvas.height / 2 + 30);
            }
        }

        // プレイヤーの描画
        function drawPlayer() {
            // プレイヤーの機体
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.moveTo(player.x + player.width/2, player.y);
            ctx.lineTo(player.x + player.width, player.y + player.height);
            ctx.lineTo(player.x, player.y + player.height);
            ctx.closePath();
            ctx.fill();
            
            // プレイヤーの光る効果
            ctx.shadowBlur = 15;
            ctx.shadowColor = player.color;
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // プレイヤーのコックピット
            ctx.fillStyle = '#b3e5fc';
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y + player.height/3, player.width/5, 0, Math.PI * 2);
            ctx.fill();
            
            // プレイヤーのエンジン効果
            if (player.isMovingLeft || player.isMovingRight) {
                ctx.fillStyle = '#ff9800';
                ctx.beginPath();
                ctx.ellipse(player.x + player.width/2, player.y + player.height + 5, 
                           player.isMovingLeft ? 15 : 10, player.isMovingRight ? 15 : 10, 
                           0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#ff9800';
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        // 背景の星を描画
        function drawStars() {
            // 固定された星を描画するために乱数シードを固定
            const starCount = 100;
            
            for (let i = 0; i < starCount; i++) {
                // 擬似乱数生成（毎フレーム同じ星の位置になるように）
                const x = (i * 131) % canvas.width;
                const y = (i * 237) % canvas.height;
                const size = (i % 3) + 1;
                const brightness = 0.5 + (i % 10) / 20;
                
                ctx.fillStyle = `rgba(255, 255, 255, ${brightness})`;
                ctx.fillRect(x, y, size, size);
            }
        }

        // ゲームループ
        function gameLoop() {
            updateGame();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // ゲームスタート
        function startGame() {
            game = {
                running: true,
                paused: false,
                score: 0,
                lives: 3,
                level: 1,
                enemySpeed: 2,
                enemySpawnRate: 100,
                lastEnemySpawn: 0,
                gameOver: false
            };
            
            player.x = canvas.width / 2 - 25;
            player.y = canvas.height - 60;
            bullets = [];
            enemies = [];
            particles = [];
            
            scoreElement.textContent = game.score;
            livesElement.textContent = game.lives;
            levelElement.textContent = game.level;
            
            gameMessage.style.display = 'none';
            pauseButton.textContent = 'ポーズ';
            
            // ゲームループを開始
            if (!gameLoop.running) {
                gameLoop();
            }
        }

        // ゲームオーバー
        function gameOver() {
            game.running = false;
            game.gameOver = true;
            
            messageTitle.textContent = 'ゲームオーバー';
            messageText.textContent = `最終スコア: ${game.score}`;
            messageButton.textContent = 'もう一度プレイ';
            gameMessage.style.display = 'block';
        }

        // ポーズ/再開
        function togglePause() {
            if (!game.running || game.gameOver) return;
            
            game.paused = !game.paused;
            pauseButton.textContent = game.paused ? '再開' : 'ポーズ';
            
            if (game.paused) {
                messageTitle.textContent = 'ポーズ中';
                messageText.textContent = 'Pキーまたはボタンを押して再開';
                messageButton.textContent = '再開';
                gameMessage.style.display = 'block';
            } else {
                gameMessage.style.display = 'none';
            }
        }

        // メッセージ表示
        function showMessage(title, text) {
            messageTitle.textContent = title;
            messageText.textContent = text;
            messageButton.textContent = '続ける';
            gameMessage.style.display = 'block';
            
            // 3秒後にメッセージを非表示
            setTimeout(() => {
                if (game.running && !game.paused) {
                    gameMessage.style.display = 'none';
                }
            }, 3000);
        }

        // イベントリスナーの設定
        startButton.addEventListener('click', () => {
            if (game.running && !game.paused) {
                // ゲームが実行中ならリスタート
                startGame();
            } else if (game.gameOver) {
                // ゲームオーバーならリスタート
                startGame();
            } else {
                // それ以外の場合はゲームを開始
                startGame();
            }
        });

        pauseButton.addEventListener('click', togglePause);
        
        messageButton.addEventListener('click', () => {
            if (game.gameOver) {
                startGame();
            } else if (game.paused) {
                togglePause();
            } else {
                gameMessage.style.display = 'none';
                if (!game.running) {
                    startGame();
                }
            }
        });

        // 初期メッセージ表示
        gameMessage.style.display = 'block';

        // ゲームループの開始
        gameLoop();
    </script>
</body>
</html>